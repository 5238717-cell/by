{% extends "base.html" %}

{% block title %}服务器配置 - Webhook 配置管理系统{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-server"></i> 服务器配置</h2>
</div>

<div class="card">
    <div class="card-header">
        基本配置
    </div>
    <div class="card-body">
        <form id="serverForm">
            <div class="mb-4">
                <label class="form-label">监听地址 *</label>
                <input type="text" class="form-control" id="serverHost" value="{{ config.server.host }}" required>
                <div class="form-text">
                    服务器绑定的地址，0.0.0.0 表示监听所有网络接口
                </div>
            </div>
            
            <div class="mb-4">
                <label class="form-label">监听端口 *</label>
                <input type="number" class="form-control" id="serverPort" value="{{ config.server.port }}" min="1" max="65535" required>
                <div class="form-text">
                    服务器监听的端口号，范围 1-65535
                </div>
            </div>
            
            <div class="mb-4">
                <label class="form-label">工作进程数 *</label>
                <input type="number" class="form-control" id="serverWorkers" value="{{ config.server.workers }}" min="1" max="10" required>
                <div class="form-text">
                    并发处理的工作进程数量，建议根据服务器性能调整
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> <strong>提示：</strong>修改配置后需要重启 Webhook 服务器才能生效。
            </div>
            
            <button type="button" class="btn btn-primary" onclick="saveServerConfig()">
                <i class="bi bi-save"></i> 保存配置
            </button>
        </form>
    </div>
</div>

<!-- 配置预览 -->
<div class="card mt-4">
    <div class="card-header">
        <i class="bi bi-eye"></i> 配置预览
    </div>
    <div class="card-body">
        <pre><code>{
  "server": {
    "host": "{{ config.server.host }}",
    "port": {{ config.server.port }},
    "workers": {{ config.server.workers }}
  }
}</code></pre>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
async function saveServerConfig() {
    const serverData = {
        host: document.getElementById('serverHost').value.trim(),
        port: document.getElementById('serverPort').value,
        workers: document.getElementById('serverWorkers').value
    };
    
    if (!serverData.host || !serverData.port || !serverData.workers) {
        showAlert('请填写所有必填字段', 'danger');
        return;
    }
    
    try {
        await apiRequest('/api/server', {
            method: 'POST',
            body: JSON.stringify(serverData)
        });
        
        showAlert('服务器配置保存成功', 'success');
    } catch (error) {
        console.error('Error saving server config:', error);
    }
}
</script>
{% endblock %}
