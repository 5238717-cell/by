{% extends "base.html" %}

{% block title %}仪表板 - Webhook 配置管理系统{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-speedometer2"></i> 仪表板</h2>
    <div>
        <span class="badge bg-success">系统运行中</span>
    </div>
</div>

<!-- 统计卡片 -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">Webhook 数量</h6>
                        <h3 class="mb-0">{{ config.webhooks|length }}</h3>
                    </div>
                    <div class="stat-icon text-primary">
                        <i class="bi bi-link-45deg"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stat-card success">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">已启用</h6>
                        <h3 class="mb-0">{{ config.webhooks|selectattr('enabled')|list|length }}</h3>
                    </div>
                    <div class="stat-icon text-success">
                        <i class="bi bi-check-circle"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stat-card warning">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">服务器端口</h6>
                        <h3 class="mb-0">{{ config.server.port }}</h3>
                    </div>
                    <div class="stat-icon text-warning">
                        <i class="bi bi-server"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card stat-card info">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1">工作进程</h6>
                        <h3 class="mb-0">{{ config.server.workers }}</h3>
                    </div>
                    <div class="stat-icon text-info">
                        <i class="bi bi-cpu"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 配置概览 -->
<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-info-circle"></i> 系统配置概览
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tbody>
                        <tr>
                            <td><strong>服务器地址</strong></td>
                            <td>{{ config.server.host }}:{{ config.server.port }}</td>
                        </tr>
                        <tr>
                            <td><strong>工作进程数</strong></td>
                            <td>{{ config.server.workers }}</td>
                        </tr>
                        <tr>
                            <td><strong>消息过滤</strong></td>
                            <td>
                                {% if config.message_processing.enable_filter %}
                                    <span class="badge bg-success">已启用</span>
                                {% else %}
                                    <span class="badge bg-danger">已禁用</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>Agent 分析</strong></td>
                            <td>
                                {% if config.message_processing.enable_agent_analysis %}
                                    <span class="badge bg-success">已启用</span>
                                {% else %}
                                    <span class="badge bg-danger">已禁用</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>自动交易</strong></td>
                            <td>
                                {% if config.message_processing.auto_trade %}
                                    <span class="badge bg-warning">已启用</span>
                                {% else %}
                                    <span class="badge bg-secondary">已禁用</span>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <td><strong>保存到表格</strong></td>
                            <td>
                                {% if config.message_processing.save_to_bitable %}
                                    <span class="badge bg-success">已启用</span>
                                {% else %}
                                    <span class="badge bg-danger">已禁用</span>
                                {% endif %}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <i class="bi bi-shield-check"></i> 过滤规则统计
            </div>
            <div class="card-body">
                <table class="table table-sm">
                    <tbody>
                        <tr>
                            <td><strong>排除关键词</strong></td>
                            <td>
                                <span class="badge bg-secondary">{{ config.filter_rules.exclude_keywords|length }} 个</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>交易关键词</strong></td>
                            <td>
                                <span class="badge bg-primary">{{ config.filter_rules.trading_keywords|length }} 个</span>
                            </td>
                        </tr>
                        <tr>
                            <td><strong>排除模式</strong></td>
                            <td>
                                <span class="badge bg-info">{{ config.filter_rules.exclude_patterns|length }} 个</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <hr>
                
                <h6>快速操作</h6>
                <div class="d-grid gap-2">
                    <a href="/webhooks" class="btn btn-primary">
                        <i class="bi bi-link-45deg"></i> 管理 Webhook
                    </a>
                    <a href="/server" class="btn btn-outline-primary">
                        <i class="bi bi-server"></i> 配置服务器
                    </a>
                    <a href="/filters" class="btn btn-outline-primary">
                        <i class="bi bi-funnel"></i> 配置过滤规则
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

{% if config.webhooks %}
<!-- Webhook 列表预览 -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-link-45deg"></i> Webhook 端点列表</span>
                <a href="/webhooks" class="btn btn-sm btn-primary">
                    <i class="bi bi-plus"></i> 添加 Webhook
                </a>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>名称</th>
                                <th>ID</th>
                                <th>URL 路径</th>
                                <th>来源</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for webhook in config.webhooks %}
                            <tr>
                                <td>{{ webhook.name }}</td>
                                <td><code>{{ webhook.id }}</code></td>
                                <td><code>{{ webhook.url_path }}</code></td>
                                <td>{{ webhook.source }}</td>
                                <td>
                                    {% if webhook.enabled %}
                                        <span class="badge bg-success">已启用</span>
                                    {% else %}
                                        <span class="badge bg-secondary">已禁用</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="/webhooks" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-pencil"></i> 编辑
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}
