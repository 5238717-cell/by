# Webhook 配置可视化输入功能 - 快速指南

## 🎯 功能概述

Webhook 服务器现在支持**可视化配置输入**，在首次运行时会自动启动交互式配置向导，帮助您快速完成系统配置。

## 🚀 快速开始

### 方法 1：首次运行自动触发（推荐）

```bash
# 删除现有配置文件（如果存在）
rm config/webhook_config.json

# 启动 Webhook 服务器
python src/webhook_server.py
```

系统会自动检测到配置文件不存在，并启动配置向导。

### 方法 2：手动运行配置向导

```bash
# 使用配置脚本（推荐）
python scripts/init_webhook_config.py

# 或者直接运行配置向导模块
python src/utils/config/config_initializer.py
```

## 📋 配置向导流程

配置向导将引导您完成以下配置：

### 1️⃣ Webhook 端点配置
```
【配置 Webhook 端点】
------------------------------------------------------------
Webhook ID (如: webhook_001) [webhook_001]: 
Webhook 名称 [飞书交易信号Webhook]: 
URL 路径 (如: /webhook/trading) [/webhook/trading]: 
是否启用 [Y/n]: 
描述 [接收飞书群交易信号消息]: 
消息来源 (如: feishu/telegram) [feishu]: 
验证令牌 (可选) : 
```

**提示**：
- 按 Enter 使用默认值（括号中显示）
- 可以配置多个 Webhook 端点
- 建议使用有意义的 ID 和名称

### 2️⃣ 服务器配置
```
【服务器配置】
------------------------------------------------------------
监听地址 [0.0.0.0]: 
监听端口 [8080]: 
工作进程数 [1]: 
```

**提示**：
- `0.0.0.0` 表示监听所有网络接口
- 端口号范围：1-65535
- 工作进程数根据服务器性能调整

### 3️⃣ 消息过滤规则
```
【消息过滤规则】
------------------------------------------------------------

📋 排除关键词：包含这些关键词的消息将被过滤（营销、广告等）
排除关键词（逗号分隔） [广告, 营销, 推广, ...]: 

📋 交易关键词：包含至少2个这些关键词的消息将被识别为交易消息
交易关键词（逗号分隔） [开仓, 平仓, 做多, ...]: 

📋 排除模式：匹配这些模式的消息将被过滤（分析、免责声明等）
排除模式（逗号分隔） [趋势分析, 市场分析, ...]: 
```

**提示**：
- 关键词用逗号分隔
- 可以使用默认的关键词列表
- 至少需要 2 个交易关键词才会识别为交易消息

### 4️⃣ 消息处理配置
```
【消息处理配置】
------------------------------------------------------------
启用消息过滤 [Y/n]: 
启用 Agent 分析 [Y/n]: 
自动交易 (⚠️  慎用) [y/N]: 
保存到飞书多维表格 [Y/n]: 
记录所有消息日志 [Y/n]: 
```

**提示**：
- 自动交易功能默认关闭，请谨慎使用
- 建议启用消息过滤和 Agent 分析
- 保存到表格便于后续数据分析

### 5️⃣ 配置摘要
```
【配置摘要】
------------------------------------------------------------

📌 Webhook 端点:
  ✅ 飞书交易信号Webhook (webhook_001)
     路径: /webhook/trading
     来源: feishu

📌 服务器:
  地址: 0.0.0.0:8080
  工作进程: 1

📌 过滤规则:
  排除关键词: 15 个
  交易关键词: 16 个
  排除模式: 9 个

📌 消息处理:
  消息过滤: ✅
  Agent 分析: ✅
  自动交易: ❌
  保存到表格: ✅
  记录日志: ✅

是否保存配置 [Y/n]: 
```

**提示**：
- 仔细检查配置摘要
- 确认无误后保存配置
- 保存后配置将写入 `config/webhook_config.json`

## 🔧 重新配置

如果需要重新配置系统：

```bash
# 删除现有配置
rm config/webhook_config.json

# 重新启动服务器
python src/webhook_server.py
```

配置向导会再次启动，引导您完成新的配置。

## 📊 配置文件位置

配置文件保存在：`config/webhook_config.json`

您可以手动编辑此文件，或者删除后使用配置向导重新生成。

## 🧪 测试功能

运行测试脚本验证功能是否正常：

```bash
# 测试首次运行流程
python tests/test_first_run_flow.py

# 测试配置初始化工具
python tests/test_config_initializer.py

# 查看配置向导演示
python scripts/demo_config_wizard.py
```

## 💡 使用建议

1. **首次使用**：删除配置文件，让系统自动启动配置向导
2. **调整配置**：直接编辑配置文件或重新运行配置向导
3. **多环境部署**：为不同环境创建不同的配置文件
4. **备份配置**：定期备份配置文件，避免误删

## 📖 详细文档

- [完整配置指南](docs/WEBHOOK_CONFIG_GUIDE.md)
- [主 README](README.md)

## ❓ 常见问题

### Q: 配置向导支持哪些输入格式？
A: 支持文本、数字、布尔值（Y/n）、列表（逗号分隔）等格式。

### Q: 如何跳过配置向导？
A: 提前创建有效的配置文件，服务器启动时会自动检测并跳过配置向导。

### Q: 配置文件格式有要求吗？
A: 必须是有效的 JSON 格式，包含 `webhooks`、`server`、`filter_rules`、`message_processing` 四个主要部分。

### Q: 如何验证配置是否正确？
A: 启动服务器后，访问 `http://localhost:8080/config` 查看当前配置。

## 🎉 开始使用

现在您已经了解了如何使用配置向导，立即开始配置您的 Webhook 系统吧！

```bash
rm config/webhook_config.json
python src/webhook_server.py
```

按照提示完成配置，享受便捷的可视化配置体验！
